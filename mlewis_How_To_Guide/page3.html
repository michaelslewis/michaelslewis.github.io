<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic Bootstrap Template -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Yelp API How-To Guide</title>
  <!-- Bootstrap Latest compiled and minified CSS
  <    Source: getbootstrap.com/getting-started -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Bootstrap Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

  <link rel="stylesheet" href="yelpHowTo.css">
</head>

<body>

    <nav class="navbar navbar-default">
      <ul class="nav navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="page1.html">Welcome</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="page2.html">Getting Started</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="page3.html">Making Requests</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="page4.html">Yelp's Search API</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="page5.html">Getting Responses</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="page6.html">Additional Resources</a>
        </li>
      </ul>
    </nav>
    <p>

  <div class = "container" id="body">

  <div>
    <p>

  <h2 class="sectionHead" id="yelpSearch"> Setting up a request</h2>
  <p class="lead">
    After registering for the OAuth information on the previous page, we are ready to set up a function that will generate the necessary information to include in the URL for a call to the API.
  <br><br>
    As mentioned, the authentication process for Yelp may be more complicated than other API's, due to the security requirements of OAuth 1.0a. While other API's may allow for simply adding a single API key to the URL you will be generating for your request, Yelp requires several parameters, some of which will need to be auto-generated per request. There is some information for this within the code samples provided in Yelp's <a href ="https://www.yelp.com/developers/documentation/v2/examples">documentation tab.</a> However, they do not provide any information that would allow us to do this using JavaScript. Therefore, we will demonstrate how to configure a GET request as follows.
  </p>

  <dl class="dl-horizontal">
  <dt> GET requests </dt>
  <dd> When making a call to Yelp's API, we are really acting as the <mark>client</mark> making a call to a specific <mark>server</mark>.
    This method of communication is called Hyper-Text Transfer Protocol (HTTP) and the specific call that we make is a GET request.
    In general, a GET request is a request to retrieve data, as opposed to sending data (a POST request). </dd>
  </dl>

  <p class="lead">
    In a GET request, the query is appended to the base url. As demonstrated below, the URL contains a base URL (url.com/?) plus a number of name/value combinations that represent the search query. Some GET requests expect several pieces of data, in which case you may have several name/value pairs. Lastly, most GET requests require an apiKey. As discussed previously, the Yelp API requires several parameters to comply with the OAuth 1.0a protocal, as follows:

  <ul class="apiKeyList">
    <li><code>oauth_consumer_key</code>: Your OAuth consumer key (from Yelp's Manage API Access).</li>

    <li><code>oauth_token</code>: The access token obtained (from Yelp's Manage API Access).</li>

    <li><code>oauth_signature_method</code>: HMAC-SHA1</li>

    <li><code>oauth_signature</code>: The request signature generated using the oauthtokensecret.</li>

    <li><code>oauth_timestamp</code>: Timestamp of the request, measured in seconds since the Unix epoch.</li>

    <li><code>oauth_nonce</code>: A unique string randomly generated upon each request.</li>
  </ul>
    <br>

    The sheer length of the URL, in addition to the necessity of autogenerating particulars such as the signature and timestamp each time the API is called, making the call difficult and impractical to formulate without the specialized JavaScript function that we will discuss shortly. However, if we were to examine the URL that is to be sent, it would appear similar to what follows, substituting a unique value wherever "####" appears:
    <div><pre><var> URL </var> = <var> url.com/? </var> + <var> &amp;name1=value1</var> + <var> &amp;name2=value2</var> + <var> &amp;oauth_token_secret=####</var> + <var> &amp;oauth_consumer_secret=####</var> + <var> &amp;oauth_consumer_key=####</var> + <var> &amp;oauth_token=####</var> + <var> &amp;oauth_signature_method=####</var> + <var> &amp;oauth_signature=####</var> + <var> &amp;oauth_timestamp=####</var> + <var> &amp;oauth_nonce=####</var></pre></div>

  <p class="lead">
    Such a URL is relatively lengthy and even requires information in addition to what was available to us when generating the authentication key through Yelp's page. Therefore, we must set up a function that will facilitate this. While the Yelp API documentation provides sample code for several other languages, such as C#, Python, and Java, to name a few, there is no sample for use with JavaScript. Fortunately, it is not too difficult to translate this into JavaScript code, and there are 3rd party examples such as <a href ="https://arian.io/how-to-use-yelps-api-with-node/"> this one </a> by Arian Faurtosh, which help to demonstrate this. However, as several node modules must be installed for the code to run, we can only illustrate the code in this guide. If you would like to run this yourself on an instance of node, please make sure to first install the following modules. These will be required in order to run the sample code:
  </p>

  <ul class="apiKeyList">
    <li><code>npm install --save oauth-signature</code></li>
    <li><code>npm install --save nonce</code></li>
    <li><code>npm install --save request</code></li>
  </ul>

    <div class="panel panel-default">
      <div class="panel-heading">
    <h3 class="panel-title">Code sample: Search for 'food' in 'Corvallis' by submitting a GET request through Yelp's Search API:</h3>
      </div>
      <div class="panel-body">

      <iframe width="100%" height="550" src="https://jsfiddle.net/mikey811fiddle/0whkdju2/embedded/js/dark/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

      <br>

        Calling the above function will generate a URL as follows, with the "####" subsitituted by our personalized, unique values, as appropriate:

        <br><br>
        Base URL: <code>https://api.yelp.com/v2/search?</code><br>
        Search parameters: <code>term=food&location=Corvallis</code><br><br>

        <div><pre><var>Final URL</var>: <var> https://api.yelp.com/v2/search?term=food&amp;location=Corvallis&amp;%oauth_token_secret=####&amp;oauth_consumer_secret=####&amp;oauth_consumer_key=####&amp;oauth_token=####&amp;oauth_signature_method=####&amp;oauth_signature=####&amp;%oauth_timestamp=####&amp;%oauth_nonce=####</var></pre></div>

        <br><br>
        <div class="alert alert-danger" role="alert">Since there is added complication when using the required OAuth modules with jsfiddle.net, viewing the results is simplified by visiting Yelp's <a href ="https://www.yelp.com/developers/api_console">API Console</a>, which will simulate the call. Simply add 'Tian Fu Noodle' to the search field, and 'Corvallis' as the location. The response to the query can be viewed by clicking on the <mark>View Response</mark> button. On the next page, we will learn more about reading the response that is returned.
        </div>

      <div>Since the above search is so general, it will return 289 restaurants. Although this could be interesting if we really want to learn all about the restaurants in the area, it would be probably be more useful for us to make a more specific search, and narrow this information down. Therefore, we will conduct another search in the sample code below, where we constrain our search to only "Chinese Restaurants". We will also use the additional 'limit' parameter to narrow the number of results returned to only '10' restaurants. Furthermore, we will set the 'sort' parameter to a value of '2', which will return our restaurants in order of the highest rated. Lastly, we will use the 'radius_filter' parameter with a value of '8000'. This last parameter measures a distance from the center of the specified location, and returns only those businesses within that radius. Since it is measured in meters, our value of '8000' will limit the results to restaurants within approximately 5 miles of Corvallis.</div><br>

    </div>
  </div>

    <div class="panel panel-default">
      <div class="panel-heading">
    <h3 class="panel-title">Code sample: Search for 'Chinese food' within '8000' meters of 'Corvallis', limited to '10' results, sorted by '2' (highest rating, descending):</h3>
      </div>
      <div class="panel-body">

      <iframe width="100%" height="550" src="https://jsfiddle.net/mikey811fiddle/w8r744gL/embedded/js/dark/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
      <br>

        Calling the above function will generate a URL as follows:

        <br><br>
        Base URL: <code>https://api.yelp.com/v2/search?</code><br>
        Search parameters: <code>Chinese+food&location=Corvallis&sort=2&limit=10&radius_filter=8000</code><br><br>

        <div><pre><var>Final URL</var>: <var> https://api.yelp.com/v2/search?term=Chinese+food&amp;location=Corvallis&amp;sort=2&amp;limit=10&amp;radius_filter=8000&amp;%oauth_token_secret=####&amp;oauth_consumer_secret=####&amp;oauth_consumer_key=####&amp;oauth_token=####&amp;oauth_signature_method=####&amp;oauth_signature=####&amp;%oauth_timestamp=####&amp;%oauth_nonce=####</var></pre></div>

        <br><br>
        <div class="alert alert-danger" role="alert">Remember to separate each parameter/value pair by a comma. Note that there is neither a comma nor a semicolon after the last pair in the object.
        </div>

  </div>

</div>

  <!-- JQuery CDN -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <!-- Bootstrap CDN -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <!-- Personal JS file -->
  <script src="how-to-guide.js"></script>

</div>
</div>

    <footer>
      <div class="container">               
        <ul class="pager">
          <li><a href="page2.html">Back</a></li>
          <li><a href="page4.html">Next</a></li>
        </ul>
      </div>
    </footer>
  </body>
</html>
