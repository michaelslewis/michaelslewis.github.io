<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic Bootstrap Template -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Yelp API How-To Guide</title>
  <!-- Bootstrap Latest compiled and minified CSS
  <    Source: getbootstrap.com/getting-started -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Bootstrap Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

  <link rel="stylesheet" href="yelpHowTo.css">
</head>

<body>

    <nav class="navbar navbar-default">
      <ul class="nav navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="index.html">Welcome</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="page2.html">Getting Started</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="page3.html">Making Requests</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="page4.html">Yelp's Search API</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="page5.html">Getting Responses</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="page6.html">Additional Resources</a>
        </li>
      </ul>
    </nav>
    <p>

  <div class = "container" id="body">

  <div>
    <p>

  <h2 class="sectionHead" id="yelpSearch"> Setting up a request</h2>
  <p class="lead">
    After registering for the Yelp API's authentication information on the previous page, we are ready to set up a function that will generate the necessary information to include in the URL for a call to the API.
  <br><br>
    As mentioned, the authentication process for Yelp may be more complicated than other API's, due to the security requirements of OAuth 1.0a. If you already have experience with API's, you might expect that you could simply add the key, token, and secrets that were generated at Yelp's API registration page into a URL to build a query like the following (substituting our unique values for the '####' placeholders I have included below):

    <br><br>
        <div><pre><var> https://api.yelp.com/v2/search?parameter_1=value_1&amp;parameter_2=value_2&amp;parameter_n=value_n&amp;oauth_consumer_key=####&amp;oauth_consumer_secret=####&amp;oauth_token=####&amp;oauth_token_secret=####</var></pre></div>
    <br><br>

  <p class="lead">
     Unfortunately, since Yelp uses OAuth authentication, the above attempt will not work. While many other API's may allow for simply appending a given API key to the URL (following a search parameter/value pair) in order to make a request, Yelp requires several parameters, including a request signature, which is auto-generated per request, using your request signature. Furthermore, at the time of this writing, the Yelp site contains very little specific instruction as to how to go about using the key, token, and signatures that they generate, and turn that into an actual API request. There are some methods for this provided within the code samples provided in Yelp's <a href ="https://www.yelp.com/developers/documentation/v2/examples" target="_blank">documentation tab.</a> However, these are for other languages, and the site does not provide any information that would allow us to do this using JavaScript. Therefore, we will demonstrate how to go about doing this using a 3rd party module, in order to configure a GET request.
  </p>

  <dl class="dl-horizontal">
  <dt> GET requests </dt>
  <dd> When we communicate with, or rather, 'make a call' to an API such as Yelp's Search API, we are acting as the <mark>client</mark>. As a client, we make our call to a specific <mark>server</mark>, in this case, a server that is hosting the Yelp API. The form of communication we are using is called <mark>HTTP</mark>, which stands for Hyper-Text Transfer Protocol. This protocol allows communication between the client and the server by means of a number of different types of calls. To make queries with the Yelp API using HTTP, we will be making a type of call called a <mark>GET request</mark>. In general, a GET request is a request to retrieve data, as opposed to sending data, which is a <mark>POST request</mark>. </dd>
  </dl>

  <p class="lead">
    When a client makes a GET request, the parameters and values of the client's query are added to the <mark>base URL</mark> of the API that is to be contacted. Thus, as we will see below the upcoming sample code, the final URL that is generated will contain the base URL (in our case, 'https://api.yelp.com/v2/search?') plus the appropriate number of parameter/value pairs that make up the search query. Additionally, most GET requests from an API will require an API key. However, as mentioned previously, the Yelp API key is made up of several items, some of which depend upon each other, in order to comply with the <mark>OAuth 1.0a protocol</mark>, which is a standardized framework that provides additional security, relative to other API's that may require only a single string for a key. If you followed the <a href ="https://www.yelp.com/developers/v2/manage_api_keys" target="_blank">link</a> from the previous page in order to set up your Yelp account, then some of these requisite items, such as your oauth_consumer_key and oauth_token, were already generated, and can be used in the script provided in the upcoming sample code. The rest of the requisite items, such as the oauth_signature and oauth_timestamp, are dependent on the items you receive from Yelp. We will use the script in the upcoming sample code to obtain those remaining items, which will then be included in the final URL. A wealth of information about the OAuth protocol can be found at the <a href ="https://oauth.net/core/1.0a/" target="_blank">OAuth Community Site</a>. Although we will not delve too deeply into the particulars of the protocol, the complete list of requisite OAuth items for the purpose of generating our final URL are as follows:

  <br><br>

  <ul class="apiKeyList">
    <li><code>oauth_consumer_key</code>: Your personal OAuth consumer key (given when we signed up for the Yelp API).</li>

    <li><code>oauth_consumer_secret</code>: Your personal OAuth consumer secret (given when we signed up for the Yelp API).</li>

    <li><code>oauth_token</code>: Your personal Oauth access token (given when we signed up for the Yelp API).</li>

    <li><code>oauth_token_secret</code>: Your personal Oauth token secret (given when we signed up for the Yelp API).</li>

    <li><code>oauth_signature_method</code>: HMAC-SHA1</li>

    <li><code>oauth_signature</code>: The request signature generated using both our consumer and token secrets. We can obtain this using a script, which I will demonstrate in the upcoming sample code examples.</li>

    <li><code>oauth_timestamp</code>: A timestamp of the request, measured in seconds since the time 00:00:00 UTC on 1 January 1970 (a starting point known as the 'Unix epoch')).</li>

    <li><code>oauth_nonce</code>: This will be a unique string that is randomly generated upon each request.</li>
  </ul>
    <br>

    <p class="lead">The above items may seem somewhat daunting, especially for someone who may be just setting out on their journey in working with API's or web development. The sheer length of the URL, in addition to the necessity of autogenerating particulars such as the signature and timestamp each time the API is called, make the call difficult and impractical to formulate without using a specialized JavaScript script like the one depicted in the sample code, towards the bottom of this page. If we were to examine the URL that the API requires for each query, it would be formatted as follows, depending on the parameters to be sent, and substituting a unique value wherever "####" appears:
    </p>

    <div><pre><var> Final URL </var> = <var> https://api.yelp.com/v2/search? </var> + <var> &amp;parameter_1=value_1</var> + <var> &amp;parameter_2=value_2</var> + <var> &amp;parameter_n=value_n</var> + <var> &amp;oauth_token_secret=####</var> + <var> &amp;oauth_consumer_secret=####</var> + <var> &amp;oauth_consumer_key=####</var> + <var> &amp;oauth_token=####</var> + <var> &amp;oauth_signature_method=####</var> + <var> &amp;oauth_signature=####</var> + <var> &amp;oauth_timestamp=####</var> + <var> &amp;oauth_nonce=####</var></pre></div>

  <p class="lead">
    Such a URL is relatively lengthy and even requires information in addition to what was available to us when generating the authentication key through Yelp's page. Therefore, we must set up a function that will facilitate this. While the Yelp API documentation provides sample code for several other languages, such as C#, Python, and Java, to name a few, there is no sample for use with JavaScript. Fortunately, it is possible to use <mark>node.js</mark>, and there are 3rd party modules such as <a href="https://github.com/olalonde/node-yelp/" target="_blank">Javascript client for Yelp's API (v2.0)</a>, by Olivier Lalonde to facilitate creating a search using OAuth 1.0a. There are also other valuable resources, such as <a href ="https://arian.io/how-to-use-yelps-api-with-node/" target="_blank"> this one</a>, by Arian Faurtosh, that are helpful in understanding more details about the OAuth parameters listed above. I will illustrate a very basic search script, below, that will demonstrate the process for authenticating, but because certain modules will be required, it will be necessary to use a development environment, such as FLIP, if you are an Oregon State University student. I will provide the sample code on jsfiddle.net, but since it will be necessary for several modules to be installed in order for the code to run, I have hosted my sample code on FLIP and provided links beneath the examples so that you may observe the results.

  <br><br>


    If you would like to run these scripts yourself and you are an OSU student, please begin by signing into your <mark>OSU VPN</mark>. This will be necessary in order to access the results of each request, since you will be hosting the script on the Engineering server. As mentioned in <a href="http://eecs.oregonstate.edu/ecampus-video/CS290/core-content/tools-and-overview/Using-Node-on-the-Engineering-Servers.html" target="_blank">Week 1</a> of the CS 290 course, you can find this information <a href="http://oregonstate.edu/helpdocs/osu-applications/offered-apps/virtual-private-network-vpn" target="_blank">here</a>. Once you are connected to VPN, please SSH into the Engineering server. The instructions for this were also given in Week 1 of the CS 290 course. Note that as mentioned there, it is important to log into one of the three <mark>flips</mark>, such as <a href="flip3.engr.oregonstate.edu" target="_blank">flip3.engr.oregonstate.edu</a>, instead of <a href="access.engr.oregonstate.edu" target="_blank">access.engr.oregonstate.edu</a>. Once you are signed into the Engineering server, please create or navigate to a directory of your choice where we can begin to set things up.

  <br><br>

    Now that you have signed in, it is time to clone the node.js module found at <a href="https://github.com/olalonde/node-yelp" target="_blank">https://github.com/olalonde/node-yelp</a>. This is a module that was authored by Olivier Lalonde (© 2012), and it is free to use as long as the copyright is included in any portions of the code you may reuse, and the license information from that page is adhered to. The module is designed for interfacing with the Yelp API to handle the tricky bits of OAuth 1.0a, and assemble them, along with search parameters we will hardcode, into a request. We can clone the module from the command prompt by typing:

    <code>git clone https://github.com/olalonde/node-yelp.git</code>.

  <br><br>

    The code will copy from github into a folder called <mark>node-yelp</mark>, within your current directory. Navigate into that folder, and using your text-editor of choice (such as VIM), open the <mark>package.json</mark> file for editing. In the top line, we see the parameter/value pair of <mark>"name": “yelp”</mark>. Change “yelp” to something else, such as “yelpAPI”. This will prevent a naming convention conflict that might otherwise arise when performing the yelp step. Save the modified file and exit back out of your text editor to the command line.

  <br><br>

    At this point, you should make sure that you have the <mark>yelp module</mark> properly installed, by entering the following code in the command line: <code>npm install yelp</code>. Node needs this in order for the OAuth 1.0a protocol to work.


  <br><br>

    We will now create a JavaScript file with the script that we want to use. Create a new js file in the directory. I have titled mine as “example_1.js”. For the purposes of this guide, we will be hardcoding our consumer key, consumer secret, token, and token secret into that file. We will also be hardcoding the parameter/values for our search into that file. For this search, we will keep it basic, with just a ‘term’ parameter having a value of ‘food’ and a ‘location’ parameter having a value of ‘Corvallis’. Note that you must substitute your own unique consumer/token/secret values for the placeholders I have included, which appear as ‘####’ in the sample, below:
  </p>

    <div class="panel panel-default">
      <div class="panel-heading">
    <h3 class="panel-title">Code sample: Basic search for 'food' in 'Corvallis' by submitting a GET request through Yelp's Search API, to demonstrate authenticating with the OAuth framework:</h3>
      </div>
      <div class="panel-body">

      <iframe width="100%" height="550" src="https://jsfiddle.net/mikey811fiddle/qhL4x5dx/14/embedded/js/dark/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

      <br><br>
    <p class="lead">
      After we save the above code, we can execute it as follows: <code>node example_1.js</code>. In the sample code above, this will call our search and return the response as console output. For the purpose of this demonstration, I have modified the lines in the latter section of the code to listen to an open port (in this case, '26596'), so that the console output of the response will be returned by the function call at the end of the above script, and can be displayed in your browser. The modified code appears as follows:</p>

      <br><br>
      <iframe width="100%" height="550" src="https://jsfiddle.net/mikey811fiddle/qhL4x5dx/13/embedded/js/dark/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

      <br><br>
      <div class="alert alert-danger" role="alert"><span class="lead">If you are signed into the OSU VPN, you may view the response from from the above query in your browser (as raw, unparsed text) at <a href="http://flip3.engr.oregonstate.edu:26596/" target="_blank">http://flip3.engr.oregonstate.edu:26596/</a>.</span></div>

      <br>
      <p class="lead">
        Calling the search method in the above script will send a request to the Yelp Search API (more about this on the next page). The query that is sent by the above code would appear as follows to the API, with the "####" subsitituted by our personalized, unique values, as appropriate:
      </p>
      <br><br>

      <div class="urlStyle">
        <span class="split">Base URL: <code>https://api.yelp.com/v2/search?</code></span><br>
        <span class="split">Search parameters: <code>term=food&location=Corvallis</code></span><br>
        <span class="split">Authentication data: <code>oauth_token_secret=####&oauth_consumer_secret=####&oauth_consumer_key=####&oauth_token=####&oauth_signature_method=####&oauth_signature=####&oauth_timestamp=####&oauth_nonce=####</code><span><br><br>
      </div>

        <div><pre><var>Final URL</var>: <var> https://api.yelp.com/v2/search?term=food&amp;location=Corvallis&amp;oauth_token_secret=####&amp;oauth_consumer_secret=####&amp;oauth_consumer_key=####&amp;oauth_token=####&amp;oauth_signature_method=####&amp;oauth_signature=####&amp;oauth_timestamp=####&amp;oauth_nonce=####</var></pre></div>

        <br><br>
          <p class="lead">Since there is added complication when using the required OAuth modules with jsfiddle.net, creating a query and viewing the results is simplified by visiting Yelp's <a href ="https://www.yelp.com/developers/api_console" target="_blank">API Console</a>, which will act as an interface to simulate our call. To replicate the above search, simply add 'food' as the term in the search field, and 'Corvallis' as the location. The response to the query can be viewed by clicking on the <mark>View Response</mark> button. Later, in the <a class="nav-link" href="page5.html">Getting Responses</a> section of this guide, we will learn more about how the response is returned.

      <div><p class="lead">We are now able to assemble a URL to perform a basic query. However, since the above example was intended primarily to demonstrate the authentication process with OAuth 1.0a, our search for 'food' in 'Corvallis' will return a rather broad and unwieldy result. At the time of this writing, if you view the results of the search, 289 restaurants in Corvallis are returned  (by default, only the first 20 are displayed, which is an adjustable parameter we will demonstrate on the <a class="nav-link" href="page5.html">Getting Responses</a> page of this guide. This is quite a lot of information to have to try to comprehend, especially if we are hungry or in need of quick information for finding a business. Although this could be interesting if we really want to learn about all the restaurants in a given location, it would be probably be more useful for us to make a more specific search, and narrow this information down. On the next page, we will discover just how to do this using parameters provided by the <mark>Yelp Search API</mark>, as well as more details about how we, acting on the client side, will utilize the technology of <mark>Ajax</mark> to interact with the server for an efficient outcome in our search.</div>

</div>

  <!-- JQuery CDN -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <!-- Bootstrap CDN -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <!-- Personal JS file -->
  <script src="how-to-guide.js"></script>

</div>
</div>

    <footer>
      <div class="container">               
        <ul class="pager">
          <li><a href="page2.html">Back</a></li>
          <li><a href="page4.html">Next</a></li>
        </ul>
      </div>
    </footer>
  </body>
</html>
